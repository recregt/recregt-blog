{{- define "main" }}

<div class="search-container">
  <input id="searchInput" type="text" placeholder="Search in the notes..." autofocus>
  <ul id="searchResults"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script>
let fuse;
let searchVisible = false;
let firstRun = true;

const searchInput = document.getElementById('searchInput');
const searchResults = document.getElementById('searchResults');

function loadSearch() {
  fetch('/index.json')
    .then(response => response.json())
    .then(data => {
      const options = {
        distance: 100,
        threshold: 0.4,
        ignoreLocation: true,
        keys: ['title', 'content', 'summary']
      };
      fuse = new Fuse(data, options);
    });
}

function executeSearch(term) {
  let results = fuse.search(term);
  let searchitems = '';
  if (results.length === 0) {
    searchResults.innerHTML = '<li>No results found</li>';
  } else {
    results.slice(0, 10).forEach(item => {
      searchitems += `<li><a href="${item.item.permalink}">${item.item.title}</a></li>`;
    });
    searchResults.innerHTML = searchitems;
  }
}

searchInput.addEventListener('input', function() {
  if (this.value) {
    if (firstRun) {
      loadSearch();
      firstRun = false;
    }
    executeSearch(this.value);
  } else {
    searchResults.innerHTML = '';
  }
});
</script>

<style>
.search-container {
  max-width: 800px;
  margin: 2rem auto;
  padding: 0 1rem;
}

#searchInput {
  width: 100%;
  padding: 1rem;
  font-size: 1.2rem;
  border: 2px solid var(--border);
  border-radius: 8px;
  background: var(--entry);
  color: var(--primary);
  margin-bottom: 1rem;
}

#searchResults {
  list-style: none;
  padding: 0;
}

#searchResults li {
  padding: 0.75rem;
  border-bottom: 1px solid var(--border);
}

#searchResults a {
  color: var(--primary);
  text-decoration: none;
  display: block;
}

#searchResults a:hover {
  color: var(--secondary);
}
</style>

{{- end }}