{{- /* Favicons for different devices */ -}}
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="manifest" href="/images/site.webmanifest">
<link rel="shortcut icon" href="/images/favicon.ico">



{{- /* Open Graph image for social media */ -}}
<meta property="og:image" content="{{ .Site.BaseURL }}images/og-image.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="{{ .Site.BaseURL }}images/og-image.jpg">

{{- /* Custom styles for external link icon and accessibility */ -}}
<style>
    /* External link styling for menu */
    #menu a[href^="http"]:not([href*="blog.recregt.com"]) {
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }
    
    /* Make the arrow icon more visible */
    #menu a[href^="http"]:not([href*="blog.recregt.com"])::after {
        font-size: 0.85em;
        opacity: 0.7;
    }

    /* Screen reader only class for accessibility */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    /* Better focus indicators for accessibility */
    .top-link:focus,
    #theme-toggle:focus,
    .toc summary:focus {
        outline: 2px solid var(--theme, #007acc);
        outline-offset: 2px;
    }

    #searchbox input:focus {
        outline: 2px solid var(--theme, #007acc);
        outline-offset: 2px;
    }

    /* Skip to main content link */
    .skip-to-main:focus {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 9999;
        background: var(--theme, #007acc);
        color: white;
        padding: 8px 12px;
        text-decoration: none;
        border-radius: 4px;
        width: auto;
        height: auto;
        clip: auto;
        overflow: visible;
    }
</style>

{{- /* DNS prefetch and preconnect for external resources */ -}}
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

{{- /* Service Worker for caching external resources */ -}}
<script>
// Register service worker for performance optimization
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js')
      .then(function(registration) {
        console.log('SW registered: ', registration);
      })
      .catch(function(registrationError) {
        console.log('SW registration failed: ', registrationError);
      });
  });
}

// Performance optimization: Handle Cloudflare email decode efficiently
(function() {
    // Defer Cloudflare email decode to prevent render blocking
    var cfEmailScript = document.querySelector('script[data-cfasync="false"][src*="email-decode"]');
    if (cfEmailScript) {
        cfEmailScript.defer = true;
    }
    
    // Alternative: Load email decode after critical path
    window.addEventListener('load', function() {
        if (typeof cloudflare !== 'undefined' && cloudflare.init) {
            cloudflare.init();
        }
    });
})();
</script>

{{- if .Param "math" }}
{{- /* Critical KaTeX CSS inline - no VS Code linter errors */ -}}
<style>
/* Critical KaTeX styles for immediate rendering */
.katex{font:normal 1.21em KaTeX_Main,"Times New Roman",serif;line-height:1.2;text-indent:0;text-rendering:auto;border-color:currentColor}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-mathml{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:min-content}.katex .strut{display:inline-block}.katex .textbf{font-weight:bold}.katex .textit{font-style:italic}.katex .mathnormal{font-family:KaTeX_Math,"Times New Roman",serif;font-style:italic}.katex .mathit{font-family:KaTeX_Main,"Times New Roman",serif;font-style:italic}.katex .mathrm{font-style:normal}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;white-space:nowrap}
</style>

{{- /* Preload full KaTeX CSS for complete styling */ -}}
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.16.23/dist/katex.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
{{- /* Fallback for browsers that don't support preload */ -}}
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.23/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous"></noscript>

{{- /* Load KaTeX JavaScript asynchronously */ -}}
<script>
(function() {
    // Function to load KaTeX scripts dynamically
    function loadKaTeX() {
        const katexScript = document.createElement('script');
        katexScript.src = 'https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js';
        katexScript.integrity = 'sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8';
        katexScript.crossOrigin = 'anonymous';
        
        katexScript.onload = function() {
            const autoRenderScript = document.createElement('script');
            autoRenderScript.src = 'https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js';
            autoRenderScript.integrity = 'sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05';
            autoRenderScript.crossOrigin = 'anonymous';
            
            autoRenderScript.onload = function() {
                // Render math when everything is loaded
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\(', right: '\\)', display: false},
                        {left: '\\[', right: '\\]', display: true}
                    ],
                    throwOnError: false
                });
            };
            
            document.head.appendChild(autoRenderScript);
        };
        
        document.head.appendChild(katexScript);
    }
    
    // Load KaTeX after page load to prevent render blocking
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadKaTeX);
    } else {
        loadKaTeX();
    }
})();
</script>
{{- end }}